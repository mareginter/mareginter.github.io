<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhishGuard Academy</title>
    
    <!-- Favicon para evitar erro 404 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <header>
        <h1>ğŸ“ PhishGuard Academy</h1>
        <div class="nav" id="navbar">
            <button onclick="goToDash()" id="btnDash">ğŸ“Š Dashboard</button>
            <button onclick="goToMods()" id="btnMods">ğŸ“š MÃ³dulos</button>
            <button onclick="goToSimulator()" id="btnSim">ğŸ® Simulador</button>
            <button onclick="goToBadges()" id="btnBadges">ğŸ… Conquistas</button>
            <button onclick="goToLibrary()" id="btnLib">ğŸ“– Biblioteca</button>
            <button onclick="goToCert()" id="btnCert" style="display:none">ğŸ“œ Certificado</button>
            <button onclick="goToAdmin()" id="btnAdmin" style="display:none">ğŸ‘‘ Admin</button>
            <button onclick="logout()" class="logout-btn">ğŸšª Sair</button>
            <button onclick="showHelp()" id="btnHelp" style="background:#64748b">â“ Ajuda</button>
        </div>
    </header>

    <main>
        <!-- LOGIN -->
        <div class="box" id="loginPage" style="max-width:500px;margin:4rem auto;text-align:center">
            <h2>ğŸ¯ Bem-vindo</h2>
            <p style="color:#64748b;margin:1rem 0">Sistema de FormaÃ§Ã£o em SeguranÃ§a Digital</p>
            
            <div style="margin-bottom:2rem">
                <button onclick="showLoginType('user')" id="btnLoginUser" style="margin:0.5rem">ğŸ‘¤ Colaborador</button>
                <button onclick="showLoginType('admin')" id="btnLoginAdmin" style="margin:0.5rem;background:#64748b">ğŸ‘‘ Administrador</button>
            </div>

            <div id="userLogin">
                <input type="text" id="userName" placeholder="Nome completo" />
                <input type="email" id="userEmail" placeholder="Email profissional" />
                <input type="text" id="companyCode" placeholder="CÃ³digo da Empresa (opcional)" style="font-family:monospace" />
                <!-- CAMPO DE CHAVE DE ATIVAÃ‡ÃƒO -->
                <input type="text" id="activationKey" placeholder="Chave de AtivaÃ§Ã£o (opcional)" style="font-family:monospace" />
                <br>
                <button onclick="doLogin()">â–¶ Entrar</button>
                <p id="loginMsg" style="margin-top:1rem;color:#64748b;font-size:0.9rem">
                    âš ï¸ Se nÃ£o tiver chave, contacte o administrador
                </p>
            </div>

            <div id="adminLogin" style="display:none">
                <p style="font-size:0.9rem;color:#64748b;margin-bottom:1rem">
                    <strong>Login rÃ¡pido:</strong> Email + Senha
                </p>
                
                <input type="email" id="adminEmail" placeholder="Email Administrador *" style="border-color:#8b5cf6" />
                <input type="password" id="adminPass" placeholder="Senha *" style="border-color:#8b5cf6" />
                
                <div id="adminExtraFields" style="display:none;margin-top:1rem;padding-top:1rem;border-top:2px dashed #e2e8f0">
                    <p style="font-size:0.85rem;color:#ef4444;margin-bottom:0.5rem;font-weight:700">âš ï¸ Primeira vez? Preencha tambÃ©m:</p>
                    <input type="text" id="adminName" placeholder="Nome do Administrador *" />
                    <input type="text" id="companyName" placeholder="Nome da Empresa *" />
                </div>
                
                <br>
                <button onclick="doAdminLogin()" style="background:#8b5cf6">â–¶ Entrar como Admin</button>
                <p id="adminMsg" style="margin-top:1rem;color:#64748b;font-size:0.9rem"></p>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div class="box hidden" id="dashboardPage">
            <h2>ğŸ“Š Painel de Controlo</h2>
            <div style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;padding:1.5rem;border-radius:8px;margin:1.5rem 0">
                <h3 style="margin-bottom:0.5rem">ğŸ‘‹ OlÃ¡, <span id="dashName"></span>!</h3>
                <p id="dashCompany" style="opacity:0.9"></p>
            </div>

            <div class="stat-grid">
                <div class="stat-card" style="background:linear-gradient(135deg,#3b82f6,#2563eb)">
                    <div class="stat-value" id="dashXP">0</div>
                    <div class="stat-label">XP Total</div>
                </div>
                <div class="stat-card" style="background:linear-gradient(135deg,#10b981,#059669)">
                    <div class="stat-value" id="dashMods">0</div>
                    <div class="stat-label">MÃ³dulos ConcluÃ­dos</div>
                </div>
                <div class="stat-card" style="background:linear-gradient(135deg,#f59e0b,#d97706)">
                    <div class="stat-value" id="dashBadges">0</div>
                    <div class="stat-label">Badges</div>
                </div>
                <div class="stat-card" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed)">
                    <div class="stat-value" id="dashSims">0</div>
                    <div class="stat-label">SimulaÃ§Ãµes</div>
                </div>
            </div>

            <div style="margin-top:2rem">
                <h3 style="margin-bottom:1rem">ğŸ“ˆ Progresso Global</h3>
                <div class="progress-bar" style="height:20px">
                    <div class="progress-fill" id="dashProgress" style="width:0%"></div>
                </div>
                <p style="text-align:center;margin-top:0.5rem;color:#64748b">
                    <span id="dashProgressPct">0</span>% concluÃ­do
                </p>
            </div>

            <div style="margin-top:2rem;text-align:center">
                <button onclick="goToMods()">ğŸ“š Continuar FormaÃ§Ã£o</button>
                <button onclick="goToSimulator()">ğŸ® Testar Conhecimentos</button>
                <button onclick="goToLibrary()" style="background:#f59e0b">ğŸ“– Biblioteca</button>
            </div>
        </div>

        <!-- MÃ“DULOS -->
        <div class="box hidden" id="modulesPage">
            <h2>ğŸ“š MÃ³dulos de FormaÃ§Ã£o</h2>
            <p style="color:#64748b;margin-bottom:2rem">Complete todos os mÃ³dulos para desbloquear o certificado</p>
            <div id="modulesList"></div>
            <div id="premiumModulesSection" style="display:none">
                <h3 style="margin-top:2rem;border-top:2px solid #e2e8f0;padding-top:2rem">â­ MÃ³dulos Premium</h3>
                <p style="color:#64748b;margin-bottom:2rem">ConteÃºdo avanÃ§ado disponÃ­vel apÃ³s completar os 5 mÃ³dulos bÃ¡sicos com 4/5 ou mais</p>
                <div id="premiumModulesList"></div>
            </div>
        </div>

        <!-- QUIZ -->
        <div class="box hidden" id="quizPage">
            <div id="quizContent"></div>
        </div>

        <!-- SIMULADOR -->
        <div class="box hidden" id="simulatorPage">
            <h2>ğŸ® Simulador de Phishing</h2>
            <p style="color:#64748b;margin-bottom:1rem">Teste suas habilidades em cenÃ¡rios realistas</p>
            
            <div style="background:#f8fafc;padding:1rem;border-radius:8px;margin-bottom:2rem;display:flex;justify-content:space-around">
                <div style="text-align:center">
                    <div style="font-size:1.5rem;font-weight:900;color:#3b82f6" id="simScore">0</div>
                    <div style="font-size:0.9rem;color:#64748b">Score</div>
                </div>
                <div style="text-align:center">
                    <div style="font-size:1.5rem;font-weight:900;color:#10b981" id="simXP">0</div>
                    <div style="font-size:0.9rem;color:#64748b">XP Ganho</div>
                </div>
            </div>
            
            <div id="simulatorContent"></div>
        </div>

        <!-- CONQUISTAS -->
        <div class="box hidden" id="badgesPage">
            <h2>ğŸ… Conquistas e Badges</h2>
            <p style="color:#64748b;margin-bottom:2rem">Desbloqueie badges completando desafios</p>
            
            <div style="background:#f8fafc;padding:1.5rem;border-radius:8px;margin-bottom:2rem">
                <h3 style="margin-bottom:1rem">ğŸ¯ Progresso</h3>
                <div style="display:flex;justify-content:space-around;text-align:center">
                    <div>
                        <div style="font-size:2rem;font-weight:900;color:#3b82f6" id="badgesUnlocked">0</div>
                        <div style="font-size:0.9rem;color:#64748b">Desbloqueados</div>
                    </div>
                    <div>
                        <div style="font-size:2rem;font-weight:900;color:#10b981" id="badgesXP">0</div>
                        <div style="font-size:0.9rem;color:#64748b">XP Total</div>
                    </div>
                </div>
            </div>
            
            <div id="badgesList"></div>
        </div>

        <!-- BIBLIOTECA -->
        <div class="box hidden" id="libraryPage">
            <h2>ğŸ“– Biblioteca de Recursos</h2>
            <p style="color:#64748b;margin-bottom:2rem">Materiais de referÃªncia</p>
            <div id="libraryContent"></div>
        </div>

        <!-- CERTIFICADO -->
        <div class="box hidden" id="certificatePage">
            <h2>ğŸ“œ Certificado Profissional</h2>
            <p style="color:#64748b;margin-bottom:2rem">ParabÃ©ns pela conclusÃ£o da formaÃ§Ã£o!</p>
            
            <div style="text-align:center;margin-bottom:2rem">
                <div style="display:inline-block;text-align:left;background:#f8fafc;padding:1.5rem;border-radius:8px;margin-bottom:1rem">
                    <p><strong>ğŸ‘¤ Nome:</strong> <span id="certName">-</span></p>
                    <p><strong>ğŸ“§ Email:</strong> <span id="certEmail">-</span></p>
                    <p><strong>ğŸ¢ Empresa:</strong> <span id="certCompany">-</span></p>
                    <p><strong>ğŸ“… Data de ConclusÃ£o:</strong> <span id="certDate">-</span></p>
                    <p><strong>â­ XP Total:</strong> <span id="certXP">-</span></p>
                    <p><strong>ğŸ… Badges:</strong> <span id="certBadges">-</span></p>
                </div>
            </div>
            
            <div style="text-align:center">
                <canvas id="certCanvas" width="1000" height="850" style="border:8px double #1e293b;border-radius:12px;max-width:100%;height:auto"></canvas>
                <div style="margin-top:1.5rem">
                    <button onclick="downloadCert()">â¬‡ Descarregar Certificado</button>
                    <button onclick="window.print()">ğŸ–¨ Imprimir PÃ¡gina</button>
                    <button onclick="goToDash()" style="background:#64748b">â† Voltar ao Dashboard</button>
                </div>
            </div>
        </div>

        <!-- PAINEL ADMIN -->
        <div class="box hidden" id="adminPage">
            <div style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;padding:2rem;border-radius:12px;margin-bottom:2rem">
                <h2 style="margin-bottom:0.5rem">ğŸ‘‘ Painel de AdministraÃ§Ã£o</h2>
                <p id="adminWelcome" style="opacity:0.9"></p>
            </div>

            <div class="admin-metrics">
                <div class="metric-card">
                    <div class="metric-label">ğŸ‘¥ Total Colaboradores</div>
                    <div class="metric-value" id="metricTotalUsers">0</div>
                    <div class="metric-trend up" id="metricUsersTrend">+0 este mÃªs</div>
                </div>

                <div class="metric-card success">
                    <div class="metric-label">âœ… FormaÃ§Ã£o Completa</div>
                    <div class="metric-value" id="metricCompleted">0</div>
                    <div class="metric-trend" id="metricCompletedPct">0%</div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-label">â³ Em Progresso</div>
                    <div class="metric-value" id="metricInProgress">0</div>
                    <div class="metric-trend" id="metricProgressPct">0%</div>
                </div>

                <div class="metric-card danger">
                    <div class="metric-label">âŒ NÃ£o Iniciado</div>
                    <div class="metric-value" id="metricNotStarted">0</div>
                    <div class="metric-trend" id="metricNotStartedPct">0%</div>
                </div>
            </div>

            <div class="admin-metrics">
                <div class="metric-card">
                    <div class="metric-label">ğŸ¯ Taxa de ConclusÃ£o</div>
                    <div class="metric-value" id="metricCompletionRate">0%</div>
                    <div class="progress-bar" style="margin-top:0.5rem">
                        <div class="progress-fill" id="metricCompletionBar" style="width:0%"></div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">â­ XP MÃ©dio</div>
                    <div class="metric-value" id="metricAvgXP">0</div>
                    <div style="font-size:0.85rem;color:#64748b">pontos por colaborador</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">ğŸ… Badges Totais</div>
                    <div class="metric-value" id="metricTotalBadges">0</div>
                    <div style="font-size:0.85rem;color:#64748b">na empresa</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">ğŸ® SimulaÃ§Ãµes</div>
                    <div class="metric-value" id="metricTotalSims">0</div>
                    <div class="metric-trend" id="metricSimsAvg">mÃ©dia por user</div>
                </div>
            </div>

            <div class="admin-metrics">
                <div class="metric-card premium">
                    <div class="metric-label">â­ Colaboradores Premium</div>
                    <div class="metric-value" id="metricPremiumUsers">0</div>
                    <div class="metric-trend" id="metricPremiumPct">0%</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">ğŸ“… Dias MÃ©dia de ConclusÃ£o</div>
                    <div class="metric-value" id="metricAvgDays">0</div>
                    <div style="font-size:0.85rem;color:#64748b">para completar formaÃ§Ã£o</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">ğŸ“Š Taxa de AprovaÃ§Ã£o</div>
                    <div class="metric-value" id="metricPassRate">0%</div>
                    <div style="font-size:0.85rem;color:#64748b">mÃ©dia 4/5 ou mais</div>
                </div>

                <div class="metric-card">
                    <div class="metric-label">â±ï¸ Atividade Recente</div>
                    <div class="metric-value" id="metricActive7d">0</div>
                    <div style="font-size:0.85rem;color:#64748b">Ãºltimos 7 dias</div>
                </div>
            </div>

            <div class="box" style="background:#f8fafc">
                <h3 style="margin-bottom:1rem">ğŸ“Š Desempenho por MÃ³dulo</h3>
                <div id="adminModuleStats"></div>
            </div>

            <!-- GERADOR DE CHAVES DE ATIVAÃ‡ÃƒO -->
            <div class="box" id="keyGeneratorSection" style="background:linear-gradient(135deg,#fffbeb,#fff);border-left:5px solid #f59e0b">
                <h3 style="margin-bottom:1rem;color:#d97706">ğŸ”‘ Gerador de Chaves de AtivaÃ§Ã£o</h3>
                <p style="color:#64748b;margin-bottom:1.5rem">Gere chaves para novos utilizadores</p>
                
                <div style="margin:1rem 0;display:flex;flex-wrap:wrap;gap:1rem;align-items:center">
                    <select id="keyType" style="padding:0.8rem;border-radius:6px;border:2px solid #e2e8f0;background:#fff">
                        <option value="basic">BÃ¡sica (acesso completo)</option>
                        <option value="premium">Premium (com mÃ³dulos avanÃ§ados)</option>
                        <option value="full">Elite (tudo desbloqueado)</option>
                    </select>
                    <input type="number" id="keyUses" placeholder="NÂº de utilizaÃ§Ãµes" min="1" max="100" value="1" style="padding:0.8rem;width:150px;border-radius:6px;border:2px solid #e2e8f0;background:#fff">
                    <button onclick="generateNewKey()" style="background:#10b981;padding:0.8rem 1.5rem">ğŸ« Gerar Nova Chave</button>
                </div>
                <div id="newKeyResult" style="margin-top:1rem"></div>
            </div>

            <div class="invite-box">
                <h3 style="margin-bottom:1rem">ğŸ“§ Convite para Colaboradores</h3>
                <p style="opacity:0.95;margin-bottom:1rem">Partilhe este link:</p>
                <div class="invite-link" id="inviteLink"></div>
                <button onclick="copyInviteLink()" style="background:#10b981">ğŸ“‹ Copiar Link</button>
            </div>

            <div class="box">
                <h3 style="margin-bottom:1rem">ğŸ“‹ Cronologia da FormaÃ§Ã£o</h3>
                <div id="adminTimeline"></div>
            </div>

            <div class="box">
                <h3 style="margin-bottom:1rem">ğŸ† Ranking de Colaboradores</h3>
                <div id="adminRanking"></div>
            </div>

            <div class="box">
                <h3 style="margin-bottom:1rem">ğŸ‘¥ Lista de Colaboradores</h3>
                <input type="text" placeholder="ğŸ” Pesquisar..." style="width:100%;max-width:100%;margin-bottom:1rem" onkeyup="filterEmployees(this.value)" />
                <div id="adminEmployees"></div>
            </div>

            <div class="box">
                <h3 style="margin-bottom:1rem">ğŸ“ˆ EstatÃ­sticas Detalhadas</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Status</th>
                            <th>InÃ­cio</th>
                            <th>ConclusÃ£o</th>
                            <th>DuraÃ§Ã£o</th>
                            <th>MÃ©dia</th>
                            <th>Premium</th>
                        </tr>
                    </thead>
                    <tbody id="adminDetailedStats">
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- POPUP DE BOAS-VINDAS MELHORADO -->
    <div id="welcomeOverlay" class="welcome-overlay hidden"></div>
    <div id="welcomePopup" class="welcome-popup hidden">
        <div style="text-align:right">
            <button onclick="closeWelcomePopup()" style="background:#64748b;padding:0.5rem 1rem;font-size:0.9rem">âœ• Fechar</button>
        </div>
        
        <div style="text-align:center;margin-bottom:2rem">
            <div style="font-size:4rem;margin-bottom:1rem">ğŸ“</div>
            <h2 style="color:#3b82f6;margin-bottom:0.5rem">Bem-vindo Ã  Academia Anti-Phishing Elite!</h2>
            <p style="color:#64748b">Vamos comeÃ§ar a sua jornada de formaÃ§Ã£o em seguranÃ§a digital</p>
        </div>
        
        <div class="welcome-feature">
            <div class="welcome-feature-icon">ğŸ¯</div>
            <div>
                <h4 style="color:#3b82f6;margin-bottom:0.5rem">ğŸ¯ COMO FUNCIONA</h4>
                <p><strong>1. MÃ³dulos de FormaÃ§Ã£o</strong> - 5 mÃ³dulos progressivos sobre seguranÃ§a</p>
                <p><strong>2. Quizzes</strong> - Teste seu conhecimento apÃ³s cada mÃ³dulo</p>
                <p><strong>3. Simulador</strong> - Pratique com emails reais de phishing</p>
                <p><strong>4. Conquistas</strong> - Ganhe badges e XP por progresso</p>
            </div>
        </div>
        
        <div class="welcome-feature" style="background:#fef3c7">
            <div class="welcome-feature-icon">ğŸ’¡</div>
            <div>
                <h4 style="color:#d97706;margin-bottom:0.5rem">ğŸ’¡ DICA IMPORTANTE</h4>
                <p><strong>Se ainda nÃ£o te sentes preparado para os quizzes ou simulador:</strong></p>
                <p>ğŸ“ <strong>Vai primeiro Ã  Biblioteca!</strong></p>
                <p>LÃ¡ encontrarÃ¡s todos os materiais para estudar ao teu ritmo, sem pressÃ£o.</p>
                <p>SÃ³ quando te sentires confiante Ã© que deves fazer os testes.</p>
            </div>
        </div>
        
        <div class="welcome-feature">
            <div class="welcome-feature-icon">ğŸ“Š</div>
            <div>
                <h4 style="color:#10b981;margin-bottom:0.5rem">ğŸ“Š O TEU PROGRESSO</h4>
                <p>âœ… <strong>Dashboard</strong> - VÃª teu progresso e estatÃ­sticas</p>
                <p>âœ… <strong>MÃ³dulos</strong> - Conclui um de cada vez</p>
                <p>âœ… <strong>Biblioteca</strong> - Estuda quando quiseres</p>
                <p>âœ… <strong>Certificado</strong> - Ganha certificado ao completar todos os mÃ³dulos</p>
            </div>
        </div>
        
        <div class="welcome-feature" style="background:#dbeafe">
            <div class="welcome-feature-icon">âš¡</div>
            <div>
                <h4 style="color:#1d4ed8;margin-bottom:0.5rem">âš¡ COMEÃ‡A POR AQUI</h4>
                <p><strong>RecomendaÃ§Ã£o para iniciantes:</strong></p>
                <ol style="text-align:left;margin:1rem 0">
                    <li>Primeiro, visita a <strong>Biblioteca</strong> para aprender os conceitos</li>
                    <li>Depois, faz o <strong>MÃ³dulo 1: IntroduÃ§Ã£o ao Phishing</strong></li>
                    <li>Experimenta o <strong>Simulador</strong> para praticar</li>
                    <li>Continua pelos outros mÃ³dulos ao teu ritmo</li>
                </ol>
            </div>
        </div>
        
        <div style="background:#f0fdf4;padding:1.5rem;border-radius:8px;margin:2rem 0">
            <h4 style="color:#065f46;margin-bottom:1rem">ğŸ† OBJETIVO FINAL</h4>
            <p>Completar <strong>todos os 5 mÃ³dulos bÃ¡sicos</strong> para:</p>
            <p>âœ… Ganhar o <strong>Certificado Profissional</strong></p>
            <p>âœ… Desbloquear conteÃºdo <strong>Premium</strong> (se tiver mÃ©dia de 4/5 ou mais)</p>
            <p>âœ… Tornar-te um <strong>Especialista em SeguranÃ§a Digital</strong></p>
        </div>
        
        <div style="text-align:center;margin-top:2rem">
            <button onclick="goToLibraryFirst()" style="background:#f59e0b;margin-right:1rem;padding:1rem 2rem">
                ğŸ“– IR PARA BIBLIOTECA PRIMEIRO
            </button>
            <button onclick="goToDashboardFromWelcome()" style="background:#3b82f6;padding:1rem 2rem">
                ğŸ“Š VER MEU DASHBOARD
            </button>
        </div>
        
        <p style="text-align:center;color:#64748b;margin-top:2rem;font-size:0.9rem">
            Podes voltar a ver esta informaÃ§Ã£o a qualquer momento no botÃ£o de Ajuda
        </p>
    </div>

    <script src="script.js"></script>
</body>
</html>
